<div class="flex flex-col h-full">
  <div class="mb-5 ml-5 w-full max-w-md">
    <!-- titulo -->
    <title-component [title]="'Ingresos'" />
  </div>
  <!-- contenido -->
  <div class="mx-40">
    <nav-list (showDialog)="toggleVisibility()" [TotalIncome]="totalIncomes()">
    </nav-list>

    <div class="mt-4">
      <history-table
        [Data]="incomes()"
        (editIncome)="OnEditIncomeById($event)"
        (deleteIncome)="OnDeteleid($event)"
      ></history-table>
    </div>

    <dialog-form
      (closeDialog)="closeDialog()"
      [height]="'500px'"
      [width]="'500px'"
      [isVisible]="isVisible"
      [title]="'Agregar Prespuesto'"
    >
      <!-- TODO: HACER EL FORM para agregar Incomes  -->

      <form [formGroup]="IncomeForm" (submit)="OnSubmit()" novalidate>
        <div class="flex flex-col gap-4 p-4 text-black">
          <!-- Nombre -->
          <label class="flex flex-col font-semibold text-sm">
            Nombre
            <input
              type="text"
              class="mt-1 p-2 border rounded"
              formControlName="name"
            />
            @if (isFieldInvalid('name')) {
            <span class="text-red-500 text-xs mt-1">{{ getFieldError('name') }}</span>
            }
          </label>

          <!-- Descripción -->
          <label class="flex flex-col font-semibold text-sm">
            Descripción
            <input
              title="x"
              type="text"
              class="mt-1 p-2 border rounded"
              formControlName="description"
            />
            @if (isFieldInvalid('description')) {
            <span class="text-red-500 text-xs mt-1">{{ getFieldError('description') }}</span>
            }
          </label>

          <!-- Monto -->
          <label class="flex flex-col font-semibold text-sm">
            Monto
            <input
              type="number"
              class="mt-1 p-2 border rounded"
              formControlName="amount"
              min="0"
            />
            @if (isFieldInvalid('amount')) {
            <span class="text-red-500 text-xs mt-1">{{ getFieldError('amount') }}</span>
            }
          </label>

          <!-- Fecha -->
          <label class="flex flex-col font-semibold text-sm">
            Fecha
            <input
              type="date"
              class="mt-1 p-2 border rounded"
              formControlName="date"
            />
            @if (isFieldInvalid('date')) {
            <span class="text-red-500 text-xs mt-1">{{ getFieldError('date') }}</span>
            }
          </label>

          <!-- Tipo de Ingreso -->
          <label class="flex flex-col font-semibold text-sm">
            Tipo de Ingreso

            <select
              class="bg-gray-500 border border-gray-300 text-black text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block w-full p-2.5 dark:bg-white dark:border-gray-600 dark:placeholder-gray-400 dark:text-black dark:focus:ring-gray-500 dark:focus:border-gray-500"
              formControlName="typeIncome"
            >
              <option [value]="0" disabled selected class="bg-gray-200 text-black">
                Seleccione un tipo
              </option>

              @for (type of incomeType(); track type.idTypeIncomes) {
              <option [value]="type.idTypeIncomes">
                {{ type.name | titlecase }}
              </option>
              }
            </select>
            @if (isFieldInvalid('typeIncome')) {
            <span class="text-red-500 text-xs mt-1">{{ getFieldError('typeIncome') }}</span>
            }
          </label>

          <!-- Botón de enviar (puedes conectar el submit luego en el TS) -->
            <button
            type="submit"
            (click)="closeDialog()"
            class="cursor-pointer mt-4 p-2 bg-black text-white rounded transition-colors
              hover:bg-gray-800
              disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-black"
            [disabled]="!IncomeForm.valid || IncomeForm.get('typeIncome')?.value === 0"
            >
            Agregar
            </button>
        </div>
      </form>
    </dialog-form>
  </div>
</div>
